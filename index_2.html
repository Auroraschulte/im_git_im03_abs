<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to avoid people in Lucerne</title>
    <style>
        :root {
            --primary-color: #248BCC;
            --secondary-color: white;
            --accent-color: #e74c3c;
            --light-color: #e3e6e6;
            --dark-color: #34495e;
            --success-color: #2ecc71;
            --quiet-color: #2ecc71;
            --moderate-color: #f39c12;
            --busy-color: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--primary-color);
            color: var(--primary-color);
            line-height: 1.6;
        }
        
        .lucerne-app {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .hero h1, .hero h2 {
            display: inline;
            font-size: 3rem;
            line-height: 1.2;
        }
        
        .hero h1 {
            color: var(--secondary-color);
            font-weight: 300;
        }
        
        .hero h2 {
            color: var(--secondary-color);
            font-weight: 700;
        }
        
        .subtitle {
            margin-top: 1.5rem;
            font-size: 1.2rem;
            color: var(--light-color);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .slider-container {
            background: var(--primary-color);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .slider-header h2 {
            color: var(--secondary-color);
            font-size: 1.5rem;
        }
        
        .selected-day {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .slider-wrapper {
            position: relative;
            margin: 2rem 0;
        }
        
        .slider-track {
            height: 8px;
            background-color: var(--light-color);
            border-radius: 4px;
            position: relative;
        }
        
        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: transparent;
            outline: none;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .day-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .day-marker {
            text-align: center;
            font-size: 0.9rem;
            color: var(--light-color);
            width: 14.28%;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }
        
        .day-marker.active {
            font-weight: bold;
            color: var(--secondary-color);
            transform: scale(1.1);
        }
        
        .stats-display {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--light-color);
        }
        
        .comparison-section {
            background: #248BCC;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .comparison-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('image/Skizze_Kapellbruecke.png');
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            z-index: 0;
        }
        
        .comparison-section h2 {
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .comparison-chart {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: px;
            margin-top: 1rem;
            position: relative;
            z-index: 1;
            padding: 0 10px;
        }
        
        .location-bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 70px;
            height: 100%;
        }
        
        .location-bar {
            width: 50px;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 10px;
            color: white;
            font-weight: bold;
            position: relative;
            min-height: 40px;
        }
        
        .location-bar span {
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }
        
        .location-label {
            margin-top: 10px;
            color: white;
            font-size: 0.8rem;
            text-align: center;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }
        
        .location-bar:hover {
            transform: translateY(-5px);
            filter: brightness(1.1);
        }
        
        .location-bar-quiet {
            background-color: var(--quiet-color);
        }
        
        .location-bar-moderate {
            background-color: var(--moderate-color);
        }
        
        .location-bar-busy {
            background-color: var(--busy-color);
        }
        
        .status-indicator {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-quiet {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--quiet-color);
        }
        
        .status-moderate {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--moderate-color);
        }
        
        .status-busy {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--busy-color);
        }
        
        .loading {
            text-align: center;
            color: white;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }
        
        @media (max-width: 768px) {
            .hero h1, .hero h2 {
                font-size: 2.5rem;
            }
            
            .slider-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .comparison-chart {
                height: 220px;
            }
            
            .location-bar-container {
                width: 60px;
            }
            
            .location-bar {
                width: 45px;
            }
        }
        
        @media (max-width: 480px) {
            .hero h1, .hero h2 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .slider-container, .comparison-section {
                padding: 1.5rem;
            }
            
            .stats-display {
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1rem;
                min-width: 120px;
            }
            
            .comparison-chart {
                height: 200px;
            }
            
            .location-bar-container {
                width: 50px;
            }
            
            .location-bar {
                width: 40px;
                font-size: 0.8rem;
            }
            
            .location-label {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <main class="lucerne-app">
        <section class="hero">
            <h1>How to avoid </h1><h2>people</h2>
            <h1> in </h1>
            <h2>Lucerne</h2>
            
            <p class="subtitle">
                Do you want peaceful moments, stunning photos and a more relaxed Lucerne experience? 
                <br>Slide through the week to avoid the crowds.
            </p>
        </section>

        <div class="slider-container">
            <div class="slider-header">
                <h2>Select a Day</h2>
                <div class="selected-day" id="selected-day">Monday</div>
            </div>
                        
            <div class="slider-wrapper">
                <div class="slider-track"></div>
                <input type="range" min="0" max="6" value="0" class="slider" id="day-slider">
            </div>
                        
            <div class="day-markers" id="day-markers">
                <!-- Day markers will be populated by JavaScript -->
            </div>   
            
        </div>
        
        <div class="comparison-section">
            <h2>Location Comparison for <span id="comparison-day">Monday</span></h2>
            <div class="comparison-chart" id="comparison-chart">
                <div class="loading">Loading data...</div>
            </div>
            
            <div class="stats-display">
              <!--<div class="stat-card">
                    <div class="stat-value" id="visitor-count">-</div>
                    <div class="stat-label">Visitors</div>
              </div> -->
                <div class="stat-card">
                    <div class="stat-value" id="crowd-status">-</div>
                    <div class="stat-label">Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="recommendation">-</div>
                    <div class="stat-label">To Visit</div>
                </div>
            </div>
        </div>
    </main>

    <script>
       document.addEventListener('DOMContentLoaded', function() {
    const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    const locations = [
        {
            id: 'kapellbrücke',
            name: 'Kapellbrücke',
            shortName: 'Kapellbrücke',
            description: 'The iconic Chapel Bridge and Water Tower'
        },
        {
            id: 'rathausquai',
            name: 'Rathausquai',
            shortName: 'Rathausquai',
            description: 'The historic Old Town with its medieval architecture'
        },
        {
            id: 'löwendenkmal',
            name: 'Löwendenkmal',
            shortName: 'Löwendenkmal',
            description: 'The famous Lion of Lucerne rock relief'
        },
        {
            id: 'schwanenplatz',
            name: 'Schwanenplatz',
            shortName: 'Schwanenplatz',
            description: 'Central square with shopping and cafes'
        },
        {
            id: 'hertensteinstrasse',
            name: 'Hertensteinstrasse',
            shortName: 'Hertensteinstrasse',
            description: 'Lakeside promenade with beautiful views'
        }
    ];
    
    const slider = document.getElementById('day-slider');
    const selectedDayElement = document.getElementById('selected-day');
    const dayMarkersContainer = document.getElementById('day-markers');
    const comparisonChartContainer = document.getElementById('comparison-chart');
    const comparisonDayElement = document.getElementById('comparison-day');
    const visitorCountElement = document.getElementById('visitor-count');
    const crowdStatusElement = document.getElementById('crowd-status');
    const recommendationElement = document.getElementById('recommendation');
    
    let selectedDayIndex = 0;
    let visitorData = {};
    
    // Create day markers
    dayNames.forEach((day, index) => {
        const marker = document.createElement('div');
        marker.className = 'day-marker';
        if (index === 0) marker.classList.add('active');
        marker.textContent = day.substring(0, 3);
        marker.dataset.index = index;
        dayMarkersContainer.appendChild(marker);
    });
    
    // Load visitor data from API using the existing getWeeklyAverages function
    async function loadVisitorData() {
        try {
            // Use the existing getWeeklyAverages function
            const weeklyAverages = await getWeeklyAverages();
            
            if (weeklyAverages) {
                // Convert the data format for UI usage
                visitorData = convertToUIData(weeklyAverages);
                updateDayDisplay();
            } else {
                throw new Error('No data received from API');
            }
        } catch (error) {
            console.error('Error loading visitor data:', error);
            // Fallback to sample data if API fails
            visitorData = generateSampleData();
            updateDayDisplay();
        }
    }
    
    // Convert the getWeeklyAverages format to UI data format
    function convertToUIData(weeklyAverages) {
        const uiData = {};
        
        // Map German day names to English
        const dayNameMap = {
            'Sonntag': 'Sunday',
            'Montag': 'Monday', 
            'Dienstag': 'Tuesday',
            'Mittwoch': 'Wednesday',
            'Donnerstag': 'Thursday',
            'Freitag': 'Friday',
            'Samstag': 'Saturday'
        };
        
        // Initialize data structure for all locations
        locations.forEach(location => {
            uiData[location.id] = {
                name: location.name,
                days: Array(7).fill().map((_, index) => ({
                    day: dayNames[index],
                    visitors: 0,
                    count: 0
                }))
            };
        });
        
        // Fill with actual data from getWeeklyAverages
        Object.keys(weeklyAverages).forEach(standort => {
            const locationId = mapStandortToId(standort);
            if (locationId && uiData[locationId]) {
                Object.keys(weeklyAverages[standort]).forEach(germanDay => {
                    const englishDay = dayNameMap[germanDay];
                    const dayIndex = dayNames.indexOf(englishDay);
                    if (dayIndex !== -1) {
                        uiData[locationId].days[dayIndex].visitors = weeklyAverages[standort][germanDay];
                    }
                });
            }
        });
        
        return uiData;
    }
    
    // Map German location names to IDs
    function mapStandortToId(standort) {
        const mapping = {
            'Kapellbrücke': 'kapellbrücke',
            'Rathausquai': 'rathausquai', 
            'Löwendenkmal': 'löwendenkmal',
            'Schwanenplatz': 'schwanenplatz',
            'Hertensteinstrasse': 'hertensteinstrasse'
        };
        return mapping[standort];
    }
    
    // Update display based on selected day
    function updateDayDisplay() {
        const dayName = dayNames[selectedDayIndex];
        selectedDayElement.textContent = dayName;
        comparisonDayElement.textContent = dayName;
        
        // Update active day marker
        document.querySelectorAll('.day-marker').forEach((marker, index) => {
            if (index === selectedDayIndex) {
                marker.classList.add('active');
            } else {
                marker.classList.remove('active');
            }
        });
        
        // Update visitor count and status
        updateVisitorStats();
        
        // Update comparison chart
        updateComparisonChart();
    }
    
    // Update visitor stats based on visitor count
    function updateVisitorStats() {
        const locationData = visitorData['kapellbrücke'];
        if (!locationData) return;
        
        const dayData = locationData.days[selectedDayIndex];
        const visitorCount = dayData.visitors;
        
        // Update visitor count
        visitorCountElement.textContent = visitorCount;
        
        // Determine crowd status and color
        let status, statusClass, recommendation;
        if (visitorCount < 50) {
            status = "Quiet";
            statusClass = "status-quiet";
            recommendation = "Good";
        } else if (visitorCount < 100) {
            status = "Moderate";
            statusClass = "status-moderate";
            recommendation = "Moderate";
        } else {
            status = "Busy";
            statusClass = "status-busy";
            recommendation = "Avoid";
        }
        
        // Update status and recommendation
        crowdStatusElement.textContent = status;
        crowdStatusElement.className = `stat-value ${statusClass}`;
        recommendationElement.textContent = recommendation;
    }
    
    // Update comparison chart for selected day
    function updateComparisonChart() {
        comparisonChartContainer.innerHTML = '';
        
        // If no data yet, show loading
        if (Object.keys(visitorData).length === 0) {
            comparisonChartContainer.innerHTML = '<div class="loading">Loading data...</div>';
            return;
        }
        
        locations.forEach((location, index) => {
            const locationData = visitorData[location.id];
            if (!locationData) return;
            
            const dayData = locationData.days[selectedDayIndex];
            const visitorCount = dayData.visitors;
            
            // Determine color class based on visitor count
            let colorClass;
            if (visitorCount < 50) {
                colorClass = "location-bar-quiet";
            } else if (visitorCount < 100) {
                colorClass = "location-bar-moderate";
            } else {
                colorClass = "location-bar-busy";
            }
            
            // Create container for bar and label
            const barContainer = document.createElement('div');
            barContainer.className = 'location-bar-container';
            
            // Create the vertical bar
            const crowdBar = document.createElement('div');
            crowdBar.className = `location-bar ${colorClass}`;
            
            // Set the height based on visitor count (scaled to max 150 people)
            const maxVisitors = 700;
            const heightPercentage = Math.min(100, (visitorCount / maxVisitors) * 100);
            crowdBar.style.height = `${heightPercentage}%`;
            
            // Add visitor count as text inside the bar
            const barText = document.createElement('span');
            barText.textContent = `${visitorCount}`;
            crowdBar.appendChild(barText);
            
            // Create label for location
            const locationLabel = document.createElement('div');
            locationLabel.className = 'location-label';
            locationLabel.textContent = location.shortName;
            
            // Add bar and label to container
            barContainer.appendChild(crowdBar);
            barContainer.appendChild(locationLabel);
            
            // Add container to chart
            comparisonChartContainer.appendChild(barContainer);
        });
    }
    
    // Event listener for slider
    slider.addEventListener('input', function() {
        selectedDayIndex = parseInt(this.value);
        updateDayDisplay();
    });
    
    // Sample data for fallback (remove this when API is working)
    function generateSampleData() {
        const data = {};
        
        locations.forEach(location => {
            data[location.id] = {
                name: location.name,
                days: []
            };
            
            dayNames.forEach(day => {
                // Generate sample visitor count with some pattern based on location and day
                let baseVisitors;
                
                // Different locations have different visitor patterns
                if (location.id === 'kapellbrücke') {
                    // Chapel Bridge is busy on weekends
                    if (day === 'Saturday' || day === 'Sunday') {
                        baseVisitors = 100 + Math.random() * 50;
                    } else {
                        baseVisitors = 40 + Math.random() * 40;
                    }
                } else if (location.id === 'rathausquai') {
                    // Old Town is moderately busy most days
                    if (day === 'Saturday') {
                        baseVisitors = 80 + Math.random() * 40;
                    } else if (day === 'Sunday') {
                        baseVisitors = 60 + Math.random() * 30;
                    } else {
                        baseVisitors = 50 + Math.random() * 30;
                    }
                } else if (location.id === 'löwendenkmal') {
                    // Lion Monument is popular but not extremely crowded
                    baseVisitors = 40 + Math.random() * 40;
                } else if (location.id === 'schwanenplatz') {
                    // Central square is busy during shopping hours
                    if (day === 'Saturday') {
                        baseVisitors = 90 + Math.random() * 40;
                    } else {
                        baseVisitors = 60 + Math.random() * 40;
                    }
                } else if (location.id === 'hertensteinstrasse') {
                    // Lakeside promenade is popular on nice days
                    if (day === 'Saturday' || day === 'Sunday') {
                        baseVisitors = 70 + Math.random() * 40;
                    } else {
                        baseVisitors = 30 + Math.random() * 30;
                    }
                }
                
                const visitors = Math.round(baseVisitors);
                
                data[location.id].days.push({
                    day: day,
                    visitors: visitors
                });
            });
        });
        
        return data;
    }
    
    // Initialize by loading data
    loadVisitorData();
});
    </script>
</body>
</html>